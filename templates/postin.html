<h1>{{title}}</h1>
{% if submitError %}
    <h3 id="errorHeader" style="color: red;">{{ submitError }}</h3>
{% endif %}

<form method="POST" onsubmit="return validateForm()" enctype="multipart/form-data">

	<div class="row">
		<div class="col-xs-12 col-sm-6 col-md-9 col-lg-9">

			<table id="post_in_table">
				<tr>
					<td><label for="characteristicInput">{{ characteristicsInfo }}</label></td>
					<td><input class="input-sm col-xs-12 col-lg-12 disabledField" id="characteristicInput" name="kenmerk" type="text" readonly value="{{ characteristicsValue }}" tabindex="-1"></td> <!--Moet berekend worden yy-xxx-->
				</tr>
				<tr>
					<td>
						<label for="dateArrivedInput">{{ dateArrivedInfo }}
							<a href="#" class="required" data-toggle="popover" data-trigger="hover" data-content="{{ field_is_required }}" tabindex="-1">*</a>
							<a href="#" class="help" data-toggle="popover" data-trigger="hover" data-content="{{ help_date }}" tabindex="-1">?</a>
						</label>
					</td>
					<td><input class="input-sm col-xs-12 col-lg-12" id="dateArrivedInput" name="date" type="text" value="{{ selectedPost['date'] }}"></td>
				</tr>
				<tr>
					<td>
						<label for="senderNameInput">{{ senderNameInfo }}
							<a href="#" class="semiRequired" data-toggle="popover" data-trigger="hover" data-content="{{ field_is_semi_required_sender_name_and_institute }}" tabindex="-1">*</a>
							<a href="#" class="help" data-toggle="popover" data-trigger="hover" data-content="{{ help_sender_name }}" tabindex="-1">?</a>
						</label>
					</td>
					<td><input class="input-sm col-xs-12 col-lg-12" id="senderNameInput" name="their_name" type="text" value="{{ selectedPost['their_name'] }}"></td>
				</tr>
				<tr>
					<td>
						<label for="senderInstituteInput">{{ senderInstituteInfo }}
							<a href="#" class="semiRequired" data-toggle="popover" data-trigger="hover" data-content="{{ field_is_semi_required_sender_name_and_institute }}" tabindex="-1">*</a>
							<a href="#" class="help" data-toggle="popover" data-trigger="hover" data-content="{{ help_sender_organisation }}" tabindex="-1">?</a>
						</label>
					</td>
					<td><input class="input-sm col-xs-12 col-lg-12" id="senderInstituteInput" name="their_organisation" type="text" value="{{ selectedPost['their_organisation'] }}"></td>
				</tr>
				<tr>
					<td>
						<label for="receiverNameInput">{{ receiverNameInfo }}
							<a href="#" class="required" data-toggle="popover" data-trigger="hover" data-content="{{ field_is_required }}" tabindex="-1">*</a>
							<a href="#" class="help" data-toggle="popover" data-trigger="hover" data-content="{{ help_receiver_name }}" tabindex="-1">?</a>
						</label>
					</td>
					<td><input class="input-sm col-xs-12 col-lg-12" id="receiverNameInput" name="our_name" type="text" value="{{ selectedPost['our_name'] }}"></td>
				</tr>
				<tr>
					<td><label for="receiverInstituteInput">{{ receiverInstituteInfo }}</label></td>
					<td><input class="input-sm col-xs-12 col-lg-12 notYetDisabledField" id="receiverInstituteInput" name="our_institute" type="text" value="{{ selectedPost['our_institute'] }}"></td><!--vrije tekst veld, moet later automatisch ingevuld worden, dan niet meer aanpasbaar-->
				</tr>
				<tr>
					<td><label for="receiverDepartmentInput">{{ receiverDepartmentInfo }}</label></td>
					<td><input class="input-sm col-xs-12 col-lg-12 notYetDisabledField" id="receiverDepartmentInput" name="our_department" type="text" value="{{ selectedPost['our_department'] }}"></td><!--vrije tekst veld, moet later automatisch ingevuld worden, dan niet meer aanpasbaar-->
				</tr>
				<tr>
					<td>
						<label for="typeOfDocumentTD">{{ typeOfDocumentInfo }}
							<a href="#" class="required" data-toggle="popover" data-trigger="hover" data-content="{{ field_is_required }}" tabindex="-1">*</a>
							<a href="#" class="help" data-toggle="popover" data-trigger="hover" data-content="{{ help_type_of_document }}" tabindex="-1">?</a>
						</label>
					</td>
					<td id="typeOfDocumentTD">
						{% for key, value in documentTypeOptions %}
							<label for="{{ key }}" style="margin-right: 10px;"><input id="{{ key }}" value="{{ key }}" type="radio" name="type_of_document" {% if selectedPost['type_of_document'] == key %} checked {% endif %}> {{ value[0] }}</label>
						{% endfor %}
					</td>
				</tr>
				<tr>
					<td>
						<label for="subjectInput">{{ subjectInputInfo }}
							<a href="#" class="required" data-toggle="popover" data-trigger="hover" data-content="{{ field_is_required }}" tabindex="-1">*</a>
							<a href="#" class="help" data-toggle="popover" data-trigger="hover" data-content="{{ help_subject }}" tabindex="-1">?</a>
						</label>
					</td>
					<td><textarea class="input-sm col-xs-12 col-lg-12" id="subjectInput" name="subject">{{ selectedPost['subject'] }}</textarea></td>
				</tr>
				<tr>
					<td><label for="commentsInput">{{ commentsInputInfo }} <a href="#" class="help" data-toggle="popover" data-trigger="hover" data-content="{{ help_remarks }}" tabindex="-1">?</a></label></td>
					<td><textarea class="input-sm col-xs-12 col-lg-12" id="commentsInput" name="remarks">{{ selectedPost['remarks'] }}</textarea></td>
				</tr>
				<tr>
					<td><label for="registeredByInput" tabindex="-1">{{ registeredByInfo }}</label></td>
					<td><input class="input-sm col-xs-12 col-lg-12 disabledField" id="registeredByInput" name="registered_by" type="text" readonly value="{{ selectedPost['registered_by'] }}" tabindex="-1"></td><!--vrije tekst veld, hier moet straks automatisch de naam van de ingelogde persoon komen-->
				</tr>
			</table>

		</div>
		<div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">

			<div class="border">
				<label for="documentInput">Upload documents
					<a href="#" class="semiRequired" data-toggle="popover" data-trigger="hover" data-content="{{ field_is_semi_required }}" tabindex="-1">*</a><br>
				</label>

				<input class="input-sm col-xs-12 col-lg-12" id="documentInput" name="documentInput[]" type="file" multiple onchange="makeFileList();"><br>
				<br>
				<br>
				<div id="fileList"></div>

			</div>

			{% if files_from_post|length > 0 %}
			<div class="border attachment">
				<label>Already uploaded documents</label>
				<ul class="in_out">
					{% for file in files_from_post %}
                        <li id="attachment_list_item">
                            <button type="submit" id="openFileFromServer" name="openFileFromServer" formaction="open_file_from_post.php" value="{{ file }}">
                                <img class="attachment_button_images" src="./images/save.png">
                            </button>
                            <button type="submit" id="deleteFileFromServer" name="deleteFileFromServer" formaction="remove_file_from_post.php" value="{{ file }}">
                                <img class="attachment_button_images" src="./images/delete.png">
                            </button>
                            {{ file }}
                        </li>
{#					    <li>{{ file }} <input id="openFileFromServer" name="openFileFromServer" type="submit" formaction="open_file_from_post.php" value="Open"> <input id="deleteFileFromServer" name="deleteFileFromServer" type="submit" formaction="remove_file_from_post.php" value="Delete"></li>#}
					{% endfor %}
				</ul>
			</div>
			{% endif %}
		</div>
	</div>

	<div class="row">
		<div class="col-xs-12 inputformsubmitbutton">
			<input type="submit" name="submitValue" value="{{ submitValue }}">
			<input type="text" name="ID" value="{{ selectedPost['ID'] }}" hidden>
		</div>
	</div>
</form>


<script>
	$(document).ready(function() {

		$('#deleteFileFromServer').on('click', function(){
			return confirm("Are you sure you want to delete the file?");
		});

		$('[data-toggle="popover"]').popover();

		// sets the current date in the dateArrivedInput field, if empty
		$(function(){
			$('#dateArrivedInput').datepicker({ dateFormat: 'dd-mm-yy' });
			{% if selectedPost['date'] == "" %}
				$('#dateArrivedInput').datepicker('setDate', new Date());
			{% else %}
				var date = new Date('{{ selectedPost['date'] }}');
				$('#dateArrivedInput').datepicker('setDate', date.getDate()+"-"+(date.getUTCMonth()+1)+"-"+date.getUTCFullYear());
			{% endif %}
		});

		$('#senderNameInput').on('keyup', function(){
			autoComplete($(this), $(this).val(), 'their_name');
		});

		$('#senderInstituteInput').on('keyup', function(){
			 autoComplete($(this), $(this).val(), 'their_organisation');
		});

		$('#receiverNameInput').on('keyup', function(){
			autoComplete($(this), $(this).val(), 'our_name');
		});

		$('#receiverInstituteInput').on('keyup', function(){
			autoComplete($(this), $(this).val(), 'our_institute');
		});
	});

	function validateForm(){
	    var isValid = true;
        if($('#dateArrivedInput').val() === ""){
            isValid = false;
        }else if($('#senderNameInput').val() === "" && $('#senderInstituteInput').val() === ""){
            isValid = false;
        }else if($('#receiverNameInput').val() === ""){
            isValid = false;
        }else if($('[name="type_of_document"]').selected === false){
            isValid = false;
        }else if($('#subjectInput').val() === ""){
            isValid = false;
        }

        if(!isValid)
            alert("Not all fields have been filled out!");
        return isValid;
    }

</script>